<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 750" font-family="Inter, -apple-system, sans-serif" font-size="13">
  <defs>
    <style>
      .title { font-size: 20px; font-weight: 700; fill: #1a1a2e; }
      .subtitle { font-size: 12px; fill: #666; }
      .box { rx: 8; ry: 8; stroke-width: 2; }
      .box-label { font-size: 14px; font-weight: 600; }
      .box-detail { font-size: 11px; fill: #555; }
      .env-box { fill: #f0f4ff; stroke: #4a6cf7; }
      .compute-box { fill: #e8f5e9; stroke: #43a047; }
      .db-box { fill: #fff3e0; stroke: #ef6c00; }
      .service-box { fill: #fff; stroke: #999; stroke-width: 1.5; }
      .network-box { fill: #fce4ec; stroke: #c62828; stroke-dasharray: 6,3; }
      .external-box { fill: #f3e5f5; stroke: #7b1fa2; }
      .state-box { fill: #e3f2fd; stroke: #1565c0; }
      .arrow { stroke: #555; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-mqtt { stroke: #e65100; stroke-width: 2; fill: none; marker-end: url(#arrowhead-mqtt); }
      .arrow-sql { stroke: #1565c0; stroke-width: 2; fill: none; marker-end: url(#arrowhead-sql); }
      .arrow-https { stroke: #43a047; stroke-width: 2; fill: none; marker-end: url(#arrowhead-https); }
      .legend-text { font-size: 11px; fill: #444; }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#555"/>
    </marker>
    <marker id="arrowhead-mqtt" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e65100"/>
    </marker>
    <marker id="arrowhead-sql" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#1565c0"/>
    </marker>
    <marker id="arrowhead-https" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#43a047"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="550" y="35" text-anchor="middle" class="title">AccoReboot - Architecture Cible</text>
  <text x="550" y="55" text-anchor="middle" class="subtitle">1 projet OVH Public Cloud par environnement (test / preprod / prod)</text>

  <!-- External: GPS Trackers -->
  <rect x="30" y="200" width="140" height="70" class="box external-box"/>
  <text x="100" y="228" text-anchor="middle" class="box-label" fill="#7b1fa2">Traceurs GPS</text>
  <text x="100" y="248" text-anchor="middle" class="box-detail">IoT / vehicules</text>
  <text x="100" y="262" text-anchor="middle" class="box-detail">protocole MQTT</text>

  <!-- External: Clients -->
  <rect x="30" y="380" width="140" height="70" class="box external-box"/>
  <text x="100" y="408" text-anchor="middle" class="box-label" fill="#7b1fa2">Clients</text>
  <text x="100" y="428" text-anchor="middle" class="box-detail">Web / Mobile</text>
  <text x="100" y="442" text-anchor="middle" class="box-detail">HTTPS</text>

  <!-- OVH Project Environment box -->
  <rect x="220" y="80" width="650" height="520" class="box env-box"/>
  <text x="545" y="105" text-anchor="middle" class="box-label" fill="#4a6cf7">Projet OVH Public Cloud (par environnement)</text>

  <!-- Compute Instance -->
  <rect x="250" y="125" width="380" height="450" class="box compute-box"/>
  <text x="440" y="150" text-anchor="middle" class="box-label" fill="#43a047">Instance Compute (b3-8)</text>
  <text x="440" y="167" text-anchor="middle" class="box-detail">Ubuntu 24.04 + Docker</text>

  <!-- Caddy -->
  <rect x="280" y="185" width="320" height="55" class="box service-box"/>
  <text x="440" y="208" text-anchor="middle" class="box-label">Caddy</text>
  <text x="440" y="226" text-anchor="middle" class="box-detail">Reverse proxy + SSL auto (Let's Encrypt)</text>

  <!-- EMQX -->
  <rect x="280" y="255" width="320" height="55" class="box service-box"/>
  <text x="440" y="278" text-anchor="middle" class="box-label">EMQX</text>
  <text x="440" y="296" text-anchor="middle" class="box-detail">Broker MQTT (ports 1883 / 8883)</text>

  <!-- Node.js Backend replicas -->
  <rect x="280" y="325" width="320" height="85" class="box service-box"/>
  <text x="440" y="348" text-anchor="middle" class="box-label">Backend Node.js</text>
  <text x="440" y="366" text-anchor="middle" class="box-detail">API REST + temps reel</text>
  <!-- Replica boxes -->
  <rect x="300" y="376" width="80" height="25" rx="4" ry="4" fill="#e8f5e9" stroke="#43a047" stroke-width="1"/>
  <text x="340" y="393" text-anchor="middle" class="box-detail">replica 1</text>
  <rect x="390" y="376" width="80" height="25" rx="4" ry="4" fill="#e8f5e9" stroke="#43a047" stroke-width="1"/>
  <text x="430" y="393" text-anchor="middle" class="box-detail">replica 2</text>
  <rect x="480" y="376" width="80" height="25" rx="4" ry="4" fill="#e8f5e9" stroke="#43a047" stroke-width="1"/>
  <text x="520" y="393" text-anchor="middle" class="box-detail">replica N</text>

  <!-- PowerSync -->
  <rect x="280" y="425" width="320" height="55" class="box service-box"/>
  <text x="440" y="448" text-anchor="middle" class="box-label">PowerSync</text>
  <text x="440" y="466" text-anchor="middle" class="box-detail">Sync offline-first (mobile/web)</text>

  <!-- Docker compose label -->
  <text x="440" y="540" text-anchor="middle" class="box-detail" fill="#43a047">docker compose</text>

  <!-- Private Network -->
  <rect x="640" y="260" width="10" height="200" class="network-box" fill="#fce4ec" opacity="0.5"/>
  <text x="665" y="350" class="box-detail" fill="#c62828" transform="rotate(90, 665, 350)">vRack / VLAN prive</text>

  <!-- Managed PostgreSQL -->
  <rect x="700" y="210" width="150" height="130" class="box db-box"/>
  <text x="775" y="240" text-anchor="middle" class="box-label" fill="#ef6c00">PostgreSQL</text>
  <text x="775" y="258" text-anchor="middle" class="box-detail">Manage OVH (db1-4)</text>
  <text x="775" y="278" text-anchor="middle" class="box-detail">PG17 + TimescaleDB</text>
  <text x="775" y="298" text-anchor="middle" class="box-detail">Positions GPS</text>
  <text x="775" y="318" text-anchor="middle" class="box-detail">Donnees applicatives</text>

  <!-- S3 State Bucket -->
  <rect x="700" y="400" width="150" height="80" class="box state-box"/>
  <text x="775" y="428" text-anchor="middle" class="box-label" fill="#1565c0">OVH Object Storage</text>
  <text x="775" y="448" text-anchor="middle" class="box-detail">accoreboot-tfstate</text>
  <text x="775" y="465" text-anchor="middle" class="box-detail">Terraform state (S3)</text>

  <!-- Cloudflare DNS -->
  <rect x="700" y="510" width="150" height="60" class="box external-box"/>
  <text x="775" y="535" text-anchor="middle" class="box-label" fill="#7b1fa2">Cloudflare</text>
  <text x="775" y="553" text-anchor="middle" class="box-detail">DNS automatique</text>

  <!-- Arrows: GPS -> EMQX -->
  <path d="M 170,235 L 275,282" class="arrow-mqtt"/>
  <text x="210" y="248" class="legend-text" fill="#e65100">MQTT</text>

  <!-- Arrows: Clients -> Caddy -->
  <path d="M 170,410 L 275,215" class="arrow-https"/>
  <text x="195" y="330" class="legend-text" fill="#43a047">HTTPS</text>

  <!-- Arrows: Caddy -> Node.js -->
  <path d="M 440,240 L 440,322" class="arrow"/>

  <!-- Arrows: EMQX -> Node.js -->
  <path d="M 440,310 L 440,322" class="arrow"/>

  <!-- Arrows: EMQX -> PostgreSQL -->
  <path d="M 600,282 L 696,270" class="arrow-sql"/>
  <text x="640" y="268" class="legend-text" fill="#1565c0">SQL</text>

  <!-- Arrows: Node.js -> PostgreSQL -->
  <path d="M 600,365 L 696,290" class="arrow-sql"/>

  <!-- Arrows: PowerSync -> PostgreSQL -->
  <path d="M 600,452 L 696,310" class="arrow-sql"/>

  <!-- IaC box -->
  <rect x="30" y="580" width="840" height="110" rx="8" ry="8" fill="#f9f9f9" stroke="#ccc" stroke-width="1.5" stroke-dasharray="8,4"/>
  <text x="450" y="605" text-anchor="middle" class="box-label" fill="#666">Infrastructure as Code</text>

  <!-- Terraform -->
  <rect x="60" y="618" width="170" height="50" class="box service-box"/>
  <text x="145" y="640" text-anchor="middle" class="box-label">Terraform</text>
  <text x="145" y="657" text-anchor="middle" class="box-detail">Provisioning OVH</text>

  <!-- Ansible -->
  <rect x="260" y="618" width="170" height="50" class="box service-box"/>
  <text x="345" y="640" text-anchor="middle" class="box-label">Ansible</text>
  <text x="345" y="657" text-anchor="middle" class="box-detail">Configuration serveurs</text>

  <!-- SOPS -->
  <rect x="460" y="618" width="170" height="50" class="box service-box"/>
  <text x="545" y="640" text-anchor="middle" class="box-label">SOPS + age</text>
  <text x="545" y="657" text-anchor="middle" class="box-detail">Secrets chiffres dans Git</text>

  <!-- Makefile -->
  <rect x="660" y="618" width="170" height="50" class="box service-box"/>
  <text x="745" y="640" text-anchor="middle" class="box-label">Makefile</text>
  <text x="745" y="657" text-anchor="middle" class="box-detail">Facade unique</text>

  <!-- Legend -->
  <rect x="30" y="710" width="840" height="30" rx="4" ry="4" fill="none"/>
  <line x1="50" y1="725" x2="80" y2="725" class="arrow-mqtt" stroke-width="2"/>
  <text x="85" y="729" class="legend-text">MQTT</text>
  <line x1="150" y1="725" x2="180" y2="725" class="arrow-https" stroke-width="2"/>
  <text x="185" y="729" class="legend-text">HTTPS</text>
  <line x1="250" y1="725" x2="280" y2="725" class="arrow-sql" stroke-width="2"/>
  <text x="285" y="729" class="legend-text">SQL</text>
  <rect x="350" y="717" width="16" height="16" rx="3" ry="3" fill="#f0f4ff" stroke="#4a6cf7" stroke-width="1.5"/>
  <text x="372" y="729" class="legend-text">Projet OVH</text>
  <rect x="470" y="717" width="16" height="16" rx="3" ry="3" fill="#e8f5e9" stroke="#43a047" stroke-width="1.5"/>
  <text x="492" y="729" class="legend-text">Compute</text>
  <rect x="570" y="717" width="16" height="16" rx="3" ry="3" fill="#fff3e0" stroke="#ef6c00" stroke-width="1.5"/>
  <text x="592" y="729" class="legend-text">DB Managee</text>
  <rect x="690" y="717" width="16" height="16" rx="3" ry="3" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1.5"/>
  <text x="712" y="729" class="legend-text">Externe</text>
</svg>
