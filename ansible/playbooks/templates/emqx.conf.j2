## EMQX Configuration for AccoReboot
## Auto-generated by Ansible â€” do not edit manually

## ============================================
## Authentication - HTTP Backend
## ============================================
authentication = [
  {
    mechanism = password_based
    backend = http
    enable = true

    method = post
    url = "http://api:{{ api_port }}/mqtt/auth"
    body {
      username = "${username}"
      password = "${password}"
      clientid = "${clientid}"
      peerhost = "${peerhost}"
    }
    headers {
      "Content-Type" = "application/json"
    }

    connect_timeout = 5s
    request_timeout = 5s
    pool_size = 8
  }
]

## ============================================
## Authorization (ACL) - HTTP Backend
## ============================================
authorization {
  no_match = deny
  deny_action = disconnect
  cache {
    enable = true
    max_size = 1024
    ttl = 1m
  }

  sources = [
    {
      type = http
      enable = true

      method = post
      url = "http://api:{{ api_port }}/mqtt/acl"
      body {
        username = "${username}"
        clientid = "${clientid}"
        topic = "${topic}"
        action = "${action}"
        peerhost = "${peerhost}"
        user_id = "${client_attrs.user_id}"
        chantier_ids = "${client_attrs.chantier_ids}"
      }
      headers {
        "Content-Type" = "application/json"
      }

      connect_timeout = 5s
      request_timeout = 5s
      pool_size = 8
    }
  ]
}
